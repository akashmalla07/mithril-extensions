<html>
<head>
    <title></title>
    <script src="mithril.js"></script>
    <script src="mithril.sugartags.js"></script>
    <script src="mithril.template.js"></script>
</head>
<body>

<div id="content"></div>

<script>
var autocompleter = {
    controller: function(data, getter) {
        this.value = m.prop("");
        this.data = m.prop([]);
        this.getter = getter;

        //  Changes the list depending on input
        this.change = function(value) {
            this.value(value);

            var list = value === "" ? 
                []: 
                data.filter(function(item) {
                    return this.getter(item)
                        .toLowerCase()
                        .indexOf(value.toLowerCase()) > -1;
                }, this);
            this.data(list);
        };

        //  When an option is selected
        this.select = function(value) {
            this.value(value);
            this.data([]);
            if (this.onchange) {
                this.onchange({
                    currentTarget: {
                        value: value
                    }
                });
            }
        };
    },

    view: function(ctrl, options) {
        if (options) ctrl.onchange = options.onchange;
        with(m.sugarTags){
            return [
                INPUT({oninput: m.withAttr("value", ctrl.change.bind(ctrl)), value: ctrl.value()}),
                ctrl.data().map(function(item) {
                    return DIV({data: ctrl.getter(item), onclick: m.withAttr("data", ctrl.select.bind(ctrl))}, ctrl.getter(item));
                })
            ];
        }
    }

};



//here's an example of using the autocompleter
var dashboard = {}

dashboard.controller = function() {
    this.names = m.prop([{id: 1, name: "John"}, {id: 2, name: "Bob"}, {id: 2, name: "Mary"}]);
    this.autocompleter = new autocompleter.controller(this.names(), function(item) {
        return item.name;
    });
};

dashboard.view = function(ctrl) {
    return m("#example", [
        new autocompleter.view(ctrl.autocompleter, {onchange: m.withAttr("value", console.log)}),
    ]);
};



//initialize
m.module(document.getElementById('content'), dashboard);

</script>

</body>
</html>
